# Changelog

## [1.5.0] - 2026-01-13

### Саппорт-бот
Полностью переработал бота поддержки — теперь это полноценная тикет-система.

- Категории обращений при создании тикета (оплата, VPN, аккаунт, возврат, другое)
- Статусы тикетов: новый → в работе → ожидание ответа → решён → закрыт
- Приоритеты: низкий, обычный, высокий, срочный (для оплаты/возвратов ставится автоматом)
- Кнопки быстрых действий прямо в тикете — не нужно писать команды
- Команды для админов: `/close`, `/priority`, `/note`, `/info`
- Внутренние заметки к тикетам (пользователь их не видит)
- Оценка поддержки после закрытия тикета (1-5 звёзд)
- Команда `/newticket` для создания нового обращения
- Расширенная сводка о пользователе: ключи, транзакции, дата регистрации, сколько потратил
- Автоматическое закрытие топика в группе при закрытии тикета

---

## [1.4.9] - 2026-01-13

### Установщик
- Полностью переработан install.sh с красивым UI
- Спиннеры и прогресс вместо вывода команд
- Ошибки показываются только при неудаче
- Автообновление nginx конфига при обновлении

### Страница 502
- Красивая страница при перезапуске сервиса
- Автообновление каждые 10 секунд
- Дизайн в стиле панели управления

### Система обновлений
- Проверка по коммитам вместо версий релизов
- Автоматический перезапуск после обновления через панель
- Git установлен в Docker образ
- Быстрое обновление без пересборки контейнера

---

## [1.4.8] - 2026-01-12

### Панель управления
- Расширенное управление пользователем: сброс триала, сброс статистики, установка реф. баланса
- Кнопка полного удаления пользователя с отзывом подписки через API
- Отображение "Всего заработано" в карточке пользователя
- Ссылка на реферера в карточке пользователя
- Отображение лимита устройств из MW API

### API
- Обновлён mwshark_api.py согласно новой документации
- Поддержка параметра devices при создании/продлении подписки
- Метод change_subscription_devices для изменения лимита устройств

### Исправления
- Исправлена ошибка ValueError в show_key_handler при key_id=None
- Защита от None key_id во всех обработчиках
- Корректное отображение ключей без ID в веб-панели

---

## [1.4.7] - 2026-01-12

### Панель управления
- Добавлен блок "Информация о сервере" на Dashboard (CPU, RAM, диск, uptime)
- Ребрендинг на MW LLC
- Добавлен копирайт © 2026 MW LLC

### Исправления
- Исправлена критическая ошибка с дублированием настроек в БД
- Настройки теперь корректно отображаются в панели
- Исправлена пагинация на странице транзакций
- Добавлена автоматическая очистка дубликатов при запуске

---

## [1.4.5] - 2026-01-12

### Исправления
- Исправлено сохранение настроек (добавлен commit)
- Настройки теперь сохраняются после рестарта
- Добавлены недостающие ключи Platega в defaults

---

## [1.4.4] - 2026-01-12

### Исправления
- Исправлено сохранение настроек платежей
- Исправлено форматирование цены тарифов
- Polling проверка CryptoBot платежей без webhook
- Исправлена проверка бана пользователей

---

## [1.4.3] - 2026-01-12

### Панель управления
- Платежи вынесены в отдельный раздел
- Выбор метода оплаты для Platega (СБП QR / Карта / СБП по номеру)

---

## [1.4.2] - 2026-01-12

### Платежи
- Интеграция Platega (карта/СБП)
- Webhook для мгновенного подтверждения
- Polling проверка статуса если webhook не настроен

---

## [1.4.1] - 2026-01-12

### Панель управления
- Тарифы вынесены в отдельный раздел меню
- Страница настроек упрощена

---

## [1.4.0] - 2026-01-12

### База данных
- Миграция на aiosqlite для асинхронных операций
- Автоматический перенос данных из users.db в data.db
- Резервное копирование старой БД (.db.bak)

### Система обновлений
- Автопроверка новых версий на GitHub
- Уведомление в шапке панели
- Обновление в один клик

### Управление ключами
- Отзыв отдельного ключа пользователя
- Кнопка отзыва в карточке каждого ключа

---

## [1.3.0] - 2026-01-12

### Панель управления
- Новая страница детального управления пользователем
- Модальное окно с полной информацией о пользователе
- История ключей пользователя
- Отправка сообщений напрямую из карточки

### Новые страницы
- **Транзакции** — полная история платежей со статистикой
- **API Статистика** — баланс MW API, гранты, история покупок
- **Рассылка** — массовая отправка сообщений из панели

### Пользователи
- Поиск по ID и username
- Фильтры: все / с ключами / без ключей
- Экспорт в CSV
- Расширенная статистика

---

## [1.2.0] - 2026-01-12

### API интеграция
- Отзыв ключей через MW API (`/subscription/revoke`)
- Синхронизация с API при удалении ключей

### Дизайн
- Полный редизайн админ-панели
- Современный тёмный UI
- Боковое меню с навигацией
- Адаптивная вёрстка для мобильных
- Шрифт Inter

---

## [1.1.0] - 2026-01-11

### Основа
- Форк vless-shopbot
- Интеграция MW API
- Создание и продление подписок
- YooKassa, CryptoBot, Heleket
- Реферальная система
- Пробный период
- Support-бот

---

## Планы

- [ ] TON оплата
- [ ] Уведомления об истечении ключей
- [ ] Статистика по дням/неделям
- [ ] Промокоды
- [x] Тикет-система с категориями и приоритетами
