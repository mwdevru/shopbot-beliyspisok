{% extends "base.html" %}
{% block title %}–û–±–Ω–æ–≤–ª–µ–Ω–∏—è{% endblock %}
{% block content %}
<h1 class="page-title">–û–±–Ω–æ–≤–ª–µ–Ω–∏—è</h1>
<div class="grid-2">
<div>
<div class="card" style="margin-bottom:24px">
<div class="card-title">–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è</div>
<div style="display:flex;align-items:center;gap:16px;margin-bottom:16px">
<div style="font-size:2rem;font-weight:700;color:var(--primary)">v{{ current_version }}</div>
<div id="versionStatus" style="font-size:.875rem;color:var(--text-muted)">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
</div>
<div style="display:flex;gap:8px;flex-wrap:wrap">
<button onclick="checkUpdates()" class="btn btn-ghost btn-sm" id="checkBtn">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</button>
<button onclick="forceUpdate()" class="btn btn-primary btn-sm" id="updateBtn" style="display:none">‚¨áÔ∏è –û–±–Ω–æ–≤–∏—Ç—å</button>
</div>
</div>
<div class="card" id="updateInfo" style="display:none">
<div class="card-title">–î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</div>
<div style="margin-bottom:16px">
<div style="font-size:1.5rem;font-weight:600;color:var(--success)" id="latestVersion"></div>
</div>
<div id="changelog" style="background:var(--bg-input);padding:16px;border-radius:8px;font-size:.875rem;max-height:300px;overflow-y:auto;white-space:pre-wrap"></div>
<div style="margin-top:16px">
<a id="releaseUrl" href="#" target="_blank" class="btn btn-ghost btn-sm">üìÑ –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ GitHub</a>
</div>
</div>
<div class="card" id="noUpdate" style="display:none">
<div style="text-align:center;padding:20px">
<div style="font-size:3rem;margin-bottom:8px">‚úÖ</div>
<div style="font-size:1.125rem;font-weight:500">–£ –≤–∞—Å –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è</div>
</div>
</div>
</div>
<div>
<div class="card">
<div class="card-title">Changelog</div>
<div style="font-size:.875rem;line-height:1.8">
<div style="margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid var(--border)">
<div style="font-weight:600;color:var(--primary)">v1.4.0</div>
<ul style="margin:8px 0 0 20px;color:var(--text-muted)">
<li>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ aiosqlite</li>
<li>–ê–≤—Ç–æ–º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</li>
<li>–°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π</li>
<li>–û—Ç–∑—ã–≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π</li>
</ul>
</div>
<div style="margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid var(--border)">
<div style="font-weight:600;color:var(--primary)">v1.3.0</div>
<ul style="margin:8px 0 0 20px;color:var(--text-muted)">
<li>–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</li>
<li>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</li>
<li>API —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</li>
<li>–†–∞—Å—Å—ã–ª–∫–∞ –∏–∑ –ø–∞–Ω–µ–ª–∏</li>
</ul>
</div>
<div style="margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid var(--border)">
<div style="font-weight:600;color:var(--primary)">v1.2.0</div>
<ul style="margin:8px 0 0 20px;color:var(--text-muted)">
<li>–û—Ç–∑—ã–≤ —á–µ—Ä–µ–∑ MW API</li>
<li>–ù–æ–≤—ã–π –¥–∏–∑–∞–π–Ω –ø–∞–Ω–µ–ª–∏</li>
<li>–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤—ë—Ä—Å—Ç–∫–∞</li>
</ul>
</div>
<div>
<div style="font-weight:600;color:var(--primary)">v1.1.0</div>
<ul style="margin:8px 0 0 20px;color:var(--text-muted)">
<li>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è MW API</li>
<li>–ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã</li>
<li>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<script>
function checkUpdates(){
document.getElementById('checkBtn').disabled=true;
document.getElementById('checkBtn').textContent='–ü—Ä–æ–≤–µ—Ä–∫–∞...';
fetch('/api/check-update').then(r=>r.json()).then(data=>{
document.getElementById('checkBtn').disabled=false;
document.getElementById('checkBtn').textContent='üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è';
if(data.has_update){
document.getElementById('versionStatus').innerHTML='<span style="color:var(--warning)">–î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ!</span>';
document.getElementById('updateInfo').style.display='block';
document.getElementById('noUpdate').style.display='none';
document.getElementById('latestVersion').textContent='v'+data.latest;
document.getElementById('changelog').textContent=data.changelog||'–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è';
document.getElementById('releaseUrl').href=data.url;
document.getElementById('updateBtn').style.display='inline-flex';
window.latestData=data;
}else{
document.getElementById('versionStatus').innerHTML='<span style="color:var(--success)">–ê–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è</span>';
document.getElementById('updateInfo').style.display='none';
document.getElementById('noUpdate').style.display='block';
document.getElementById('updateBtn').style.display='none';
}
}).catch(e=>{
document.getElementById('checkBtn').disabled=false;
document.getElementById('checkBtn').textContent='üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è';
document.getElementById('versionStatus').innerHTML='<span style="color:var(--danger)">–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏</span>';
});
}
function forceUpdate(){
if(!confirm('–û–±–Ω–æ–≤–∏—Ç—å –ø–∞–Ω–µ–ª—å? –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.'))return;
document.getElementById('updateBtn').disabled=true;
document.getElementById('updateBtn').textContent='–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...';
fetch('/api/do-update',{method:'POST'}).then(r=>r.json()).then(data=>{
if(data.success){
alert('‚úÖ '+data.message+'\n\n–í—ã–ø–æ–ª–Ω–∏—Ç–µ: docker-compose restart');
location.reload();
}else{
alert('‚ùå –û—à–∏–±–∫–∞: '+data.message);
document.getElementById('updateBtn').disabled=false;
document.getElementById('updateBtn').textContent='‚¨áÔ∏è –û–±–Ω–æ–≤–∏—Ç—å';
}
}).catch(e=>{
alert('–û—à–∏–±–∫–∞: '+e);
document.getElementById('updateBtn').disabled=false;
document.getElementById('updateBtn').textContent='‚¨áÔ∏è –û–±–Ω–æ–≤–∏—Ç—å';
});
}
checkUpdates();
</script>
{% endblock %}
