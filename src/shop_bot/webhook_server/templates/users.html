{% extends "base.html" %}
{% block title %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏{% endblock %}
{% block content %}
<h1 class="page-title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h1>
<div class="stats-grid" style="margin-bottom:24px">
<div class="stat-card">
<div class="stat-label">–í—Å–µ–≥–æ</div>
<div class="stat-value">{{ users|length }}</div>
</div>
<div class="stat-card">
<div class="stat-label">–° –∫–ª—é—á–∞–º–∏</div>
<div class="stat-value">{{ users|selectattr('user_keys')|list|length }}</div>
</div>
</div>
<div class="users-grid">
{% for user in users %}
<div class="user-card {% if user.is_banned %}banned{% endif %}">
<div class="user-head">
<div class="user-avatar">{{ user.username[0]|upper if user.username else 'U' }}</div>
<div class="user-meta">
<div class="user-name">@{{ user.username or '–ë–µ–∑ –∏–º–µ–Ω–∏' }}</div>
<div class="user-id">{{ user.telegram_id }}</div>
</div>
{% if user.is_banned %}
<span class="badge badge-danger">–ë–∞–Ω</span>
{% else %}
<span class="badge badge-success">–ê–∫—Ç–∏–≤</span>
{% endif %}
</div>
<div class="user-stats">
<div class="user-stat">üîë {{ user.user_keys|length }}</div>
<div class="user-stat">üí∞ {{ "%.0f"|format(user.total_spent or 0) }}‚ÇΩ</div>
<div class="user-stat">üìÖ {{ user.total_months or 0 }} –º–µ—Å</div>
</div>
{% if user.user_keys %}
<div class="user-keys">
{% for key in user.user_keys %}
<span class="key-tag">{{ '‚úì' if key.expiry_date > now else '‚úó' }} {{ key.expiry_date[:10] }}</span>
{% endfor %}
</div>
{% endif %}
<div class="user-actions">
{% if user.is_banned %}
<form action="{{ url_for('unban_user_route', user_id=user.telegram_id) }}" method="post">
<button type="submit" class="btn btn-success btn-xs">–†–∞–∑–±–∞–Ω</button>
</form>
{% else %}
<form action="{{ url_for('ban_user_route', user_id=user.telegram_id) }}" method="post" data-confirm="–ó–∞–±–∞–Ω–∏—Ç—å?">
<button type="submit" class="btn btn-warning btn-xs">–ë–∞–Ω</button>
</form>
{% endif %}
<form action="{{ url_for('grant_key_route', user_id=user.telegram_id) }}" method="post" class="inline-form">
<input type="number" name="days" value="30" min="1" max="365" class="input-mini">
<button type="submit" class="btn btn-primary btn-xs">–í—ã–¥–∞—Ç—å</button>
</form>
{% if user.user_keys %}
<form action="{{ url_for('modify_user_days_route', user_id=user.telegram_id) }}" method="post" class="inline-form">
<input type="hidden" name="key_id" value="{{ user.user_keys[0].key_id }}">
<input type="number" name="days" placeholder="+/-" class="input-mini">
<button type="submit" class="btn btn-ghost btn-xs">¬±–î–Ω–∏</button>
</form>
<form action="{{ url_for('revoke_keys_route', user_id=user.telegram_id) }}" method="post" data-confirm="–û—Ç–æ–∑–≤–∞—Ç—å –∫–ª—é—á–∏?">
<button type="submit" class="btn btn-danger btn-xs">–û—Ç–æ–∑–≤–∞—Ç—å</button>
</form>
{% endif %}
</div>
</div>
{% endfor %}
</div>
{% endblock %}
