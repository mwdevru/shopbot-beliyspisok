<p align="center">
  <img src="https://img.shields.io/badge/version-1.5.0-6366f1?style=for-the-badge&labelColor=1e1e2e" alt="Version">
  <img src="https://img.shields.io/badge/python-3.11+-3776ab?style=for-the-badge&logo=python&logoColor=white&labelColor=1e1e2e" alt="Python">
  <img src="https://img.shields.io/badge/docker-ready-2496ED?style=for-the-badge&logo=docker&logoColor=white&labelColor=1e1e2e" alt="Docker">
  <img src="https://img.shields.io/badge/aiogram-3.x-009688?style=for-the-badge&logo=telegram&logoColor=white&labelColor=1e1e2e" alt="Aiogram">
  <img src="https://img.shields.io/badge/license-GPL--3.0-f97316?style=for-the-badge&labelColor=1e1e2e" alt="License">
</p>

<h1 align="center">
  <br>
  MW VPN Reseller Bot
  <br>
</h1>

<h4 align="center">
  Готовое решение для запуска собственного VPN-бизнеса в Telegram
</h4>

<p align="center">
  <a href="#-что-это">Что это</a> •
  <a href="#-возможности">Возможности</a> •
  <a href="#-быстрый-старт">Быстрый старт</a> •
  <a href="#-платёжные-системы">Платежи</a> •
  <a href="#-веб-панель">Панель</a> •
  <a href="#-саппорт-бот">Саппорт</a>
</p>

---

## Что это

MW VPN Reseller Bot — это полноценная платформа для реселлинга VPN-подписок через Telegram. Вы получаете готовый бизнес "из коробки": бот для клиентов, веб-панель для управления, систему поддержки и интеграцию с популярными платёжными системами.

Проект построен на [MW API](https://vpn.mwshark.host/api/docs) — надёжном бэкенде для управления VPN-подписками. Вам не нужно разбираться в серверах и протоколах — всё уже настроено.

### Для кого это?

- **Предприниматели** — запустите VPN-бизнес без технических знаний
- **Реселлеры** — автоматизируйте продажи и поддержку клиентов  
- **Разработчики** — форкните и кастомизируйте под свои нужды

---

## Возможности

<table>
<tr>
<td width="50%" valign="top">

### Telegram-бот

Полнофункциональный бот для ваших клиентов:

- **Автоматические подписки** — создание, продление, отзыв ключей через API
- **Пробный период** — настраиваемый триал для привлечения клиентов
- **Реферальная система** — клиенты приводят клиентов и получают бонусы
- **Принудительная подписка** — требуйте подписку на канал перед использованием
- **QR-коды** — генерация QR для быстрого подключения
- **Инструкции** — встроенные гайды для всех платформ (iOS, Android, Windows, Linux)
- **Рассылки** — массовые уведомления с кнопками и медиа

</td>
<td width="50%" valign="top">

### Веб-панель

Современная админка для полного контроля:

- **Dashboard** — статистика, графики, мониторинг сервера в реальном времени
- **Пользователи** — поиск, фильтры, детальные карточки, экспорт в CSV
- **Ключи** — управление подписками, продление, отзыв через API
- **Транзакции** — полная история платежей со статистикой
- **API-статистика** — баланс MW API, гранты, история покупок
- **Рассылки** — отправка сообщений прямо из панели
- **Автообновление** — обновление бота в один клик
- **Безопасность** — rate limiting, защита от инъекций, управление сессиями

</td>
</tr>
<tr>
<td valign="top">

### Платежные системы

Принимайте оплату любым удобным способом:

| Система | Методы |
|---------|--------|
| **YooKassa** | Банковские карты, СБП |
| **Platega** | СБП QR, карты, СБП по номеру |
| **CryptoBot** | Криптовалюта (BTC, ETH, USDT, TON) |
| **Heleket** | Криптовалюта |

Все платежи обрабатываются через webhooks — мгновенное подтверждение и выдача ключей.

</td>
<td valign="top">

### Саппорт-бот

Полноценная тикет-система для поддержки клиентов:

- **Категории обращений** — оплата, VPN, аккаунт, возврат и другое
- **Статусы тикетов** — новый, в работе, ожидание, решён, закрыт
- **Приоритеты** — автоматический приоритет для платежей и возвратов
- **Быстрые действия** — кнопки прямо в тикете
- **Внутренние заметки** — комментарии для команды поддержки
- **Оценка качества** — рейтинг 1-5 звёзд после закрытия
- **Сводка о клиенте** — ключи, транзакции, история в одном месте

</td>
</tr>
</table>

---

## Быстрый старт

### Требования

| Компонент | Минимум | Рекомендуется |
|-----------|---------|---------------|
| **ОС** | Ubuntu 20.04 / Debian 11 | Ubuntu 22.04 |
| **RAM** | 1 GB | 2 GB |
| **CPU** | 1 vCPU | 2 vCPU |
| **Диск** | 10 GB | 20 GB SSD |
| **Домен** | С A-записью на IP сервера | — |

### Что понадобится

1. **VPS-сервер** — любой провайдер (Timeweb, Selectel, DigitalOcean и т.д.)
2. **Домен** — для веб-панели и webhooks платёжных систем
3. **API-ключ MW** — получите у [@mwvpnbot](https://t.me/mwvpnbot)
4. **Telegram-бот** — создайте у [@BotFather](https://t.me/BotFather)

### Установка

```bash
# Подключитесь к серверу
ssh root@your-server-ip

# Запустите установщик (всё сделает автоматически)
curl -sSL https://raw.githubusercontent.com/mwdevru/shopbot-beliyspisok/main/install.sh | sudo bash
```

Установщик автоматически:
- Установит Docker и Docker Compose
- Настроит Nginx с SSL (Let's Encrypt)
- Запустит контейнер с ботом
- Настроит автозапуск при перезагрузке

### Первый запуск

1. Откройте панель: `https://your-domain.com/login`
2. Войдите с логином `admin` и паролем `admin`
3. **Сразу смените пароль!** (это важно)
4. Пройдите мастер настройки:
   - Введите API-ключ MW
   - Укажите токен бота
   - Добавьте свой Telegram ID
5. Создайте тарифные планы
6. Запустите бота из панели

---

## Платёжные системы

### Настройка webhooks

После настройки платёжной системы в панели, укажите webhook URL в личном кабинете платёжки:

| Система | Webhook URL |
|---------|-------------|
| YooKassa | `https://your-domain.com/yookassa-webhook` |
| Platega | `https://your-domain.com/platega-webhook` |
| CryptoBot | `https://your-domain.com/cryptobot-webhook` |
| Heleket | `https://your-domain.com/heleket-webhook` |

### YooKassa

1. Зарегистрируйтесь на [yookassa.ru](https://yookassa.ru)
2. Получите `Shop ID` и `Secret Key` в настройках магазина
3. Укажите webhook URL в разделе "HTTP-уведомления"
4. Введите данные в панели бота

### Platega

1. Зарегистрируйтесь на [platega.ru](https://platega.ru)
2. Создайте магазин и получите `Merchant ID` и `Secret Key`
3. Выберите метод оплаты: СБП QR / Карта / СБП по номеру
4. Настройте webhook в личном кабинете

### CryptoBot

1. Создайте приложение в [@CryptoBot](https://t.me/CryptoBot)
2. Получите API-токен
3. Укажите webhook URL в настройках приложения

---

## Веб-панель

### Разделы панели

| Раздел | Описание |
|--------|----------|
| **Dashboard** | Общая статистика, графики за 30 дней, последние транзакции, мониторинг сервера |
| **Пользователи** | Список клиентов, поиск, фильтры, детальные карточки с историей |
| **Тарифы** | Создание и редактирование тарифных планов |
| **Транзакции** | История всех платежей с фильтрацией и экспортом |
| **API-статистика** | Баланс MW API, активные гранты, история покупок |
| **Рассылка** | Массовая отправка сообщений пользователям |
| **Настройки** | Конфигурация бота, ссылки, тексты |
| **Платежи** | Настройка платёжных систем |
| **Брендинг** | Кастомизация подписок (название, описание, ссылки) |
| **Логи** | Просмотр логов в реальном времени |

### Управление пользователями

В карточке пользователя доступны:
- Просмотр всех ключей и их статусов
- Продление/отзыв подписок через API
- Бан/разбан пользователя
- Сброс пробного периода
- Изменение реферального баланса
- Отправка личного сообщения
- Полное удаление с отзывом подписки

---

## Саппорт-бот

Отдельный бот для обработки обращений клиентов. Работает через форум-топики в Telegram-группе.

### Настройка

1. Создайте второго бота у [@BotFather](https://t.me/BotFather)
2. Создайте группу и включите "Темы" (Topics)
3. Добавьте бота в группу как администратора
4. Получите ID группы (можно через [@getmyid_bot](https://t.me/getmyid_bot))
5. Укажите токен бота и ID группы в настройках панели

### Как это работает

1. Клиент пишет в саппорт-бота
2. Выбирает категорию обращения
3. Создаётся топик в группе поддержки
4. Команда видит сводку о клиенте (ключи, транзакции, история)
5. Переписка идёт через бота
6. После решения тикет закрывается, клиент ставит оценку

### Команды для поддержки

```
/close           — закрыть тикет
/priority low    — установить приоритет (low/normal/high/urgent)
/note текст      — добавить внутреннюю заметку
/info            — показать сводку о пользователе
```

---

## Управление

### Docker-команды

```bash
cd shopbot-beliyspisok

# Просмотр логов
docker-compose logs -f

# Перезапуск
docker-compose restart

# Остановка
docker-compose down

# Обновление
git pull && docker-compose up -d --build
```

### Обновление из панели

В веб-панели есть кнопка автообновления — бот проверяет новые версии на GitHub и обновляется в один клик.

---

## Структура проекта

```
src/shop_bot/
├── bot/                        # Telegram-бот
│   ├── handlers.py             # Основные обработчики команд
│   ├── keyboards.py            # Клавиатуры и кнопки
│   ├── middlewares.py          # Middleware (бан-чек и др.)
│   └── support_handlers.py     # Саппорт-бот (тикет-система)
│
├── modules/
│   └── mwshark_api.py          # Клиент MW API
│
├── data_manager/
│   ├── database.py             # SQLite + миграции
│   └── scheduler.py            # Фоновые задачи
│
└── webhook_server/
    ├── app.py                  # Flask-приложение (панель + webhooks)
    ├── templates/              # HTML-шаблоны панели
    └── static/                 # CSS, JS, изображения
```

---

## MW API

Бот использует [MW API](https://vpn.mwshark.host/api/docs) для управления подписками.

<details>
<summary><b>Используемые эндпоинты</b></summary>

| Эндпоинт | Метод | Описание |
|----------|-------|----------|
| `/api/v1/balance` | GET | Баланс аккаунта |
| `/api/v1/tariffs` | GET | Список доступных тарифов |
| `/api/v1/subscription/create` | POST | Создание новой подписки |
| `/api/v1/subscription/extend` | POST | Продление подписки |
| `/api/v1/subscription/revoke` | POST | Отзыв подписки (возврат дней) |
| `/api/v1/subscription/{uuid}` | GET | Статус подписки |
| `/api/v1/subscription/{uuid}/metadata` | PATCH | Обновление метаданных (брендинг) |
| `/api/v1/grants` | GET | Активные гранты |

</details>

---

## Changelog

Полный список изменений: **[CHANGELOG.md](CHANGELOG.md)**

### Последние обновления

- **v1.5.0** — Полностью переработанная тикет-система с категориями, приоритетами и оценками
- **v1.4.9** — Новый установщик с красивым UI, страница 502, обновление по коммитам
- **v1.4.8** — Расширенное управление пользователями, поддержка лимита устройств

---

## Поддержка

- **Документация MW API**: [vpn.mwshark.host/api/docs](https://vpn.mwshark.host/api/docs)
- **Telegram**: [@mwvpnbot](https://t.me/mwvpnbot)
- **Issues**: [GitHub Issues](https://github.com/mwdevru/shopbot-beliyspisok/issues)

---

## Лицензия

Проект распространяется под лицензией **GPL-3.0** — см. файл [LICENSE](LICENSE).

Это означает, что вы можете свободно использовать, модифицировать и распространять код, но производные работы также должны быть открыты под GPL-3.0.

---

<p align="center">
  <sub>
    Сделано командой <b>MW LLC</b><br>
    Форк <a href="https://github.com/evansvl/vless-shopbot">evansvl/vless-shopbot</a>
  </sub>
</p>

<p align="center">
  <sub>© 2026 MW LLC. All rights reserved.</sub>
</p>
